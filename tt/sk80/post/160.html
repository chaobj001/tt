<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="generator" content="blog.sk80.com" /><meta name="keywords" content="SVN on CentOS:Linux," /><meta name="description" content="SVN on CentOS,Linux CVS配置,Linux常用命令集" /><meta name="author" content="4kychao" /><link rel="stylesheet" type="text/css" href="http://sk2.com/templates/default/style.css" /><title>SVN on CentOS</title></head><body><div id="wrapper"><div id="header"><div id="header-inner"><p class="sitename">blog.sk80.com</p><div class="description">等我有钱了, 咱买棒棒糖, 买2 根, 1 根 你看着我吃, 另1根 我吃给你看。</div><div class="menu"><ul><li class="current_page"><a rel="nofollow" href="/">日志</a></li><!--li><a href="#">About</a></li--></ul></div></div></div><div id="wrapper-inner"><p id="topic-path"><a href="/" rel="nofollow">Home</a>&gt;<a href="http://sk2.com/category/linux/">Linux</a>&gt;<strong class="current">SVN on CentOS</strong></p><ul id="flip1" class="flip"><li class="newer"><a title="Linux CVS配置" href="http://sk2.com/post/161.html" rel="nofollow">Newer</a></li><li class="older"><a title="Linux常用命令集" href="http://sk2.com/post/159.html" rel="nofollow">Older</a></li></ul><div id="detail"><div class="post"><h1>SVN on CentOS</h1><ul class="info"><li class="date">2010年 03月28日  23:37</li><li class="category"><a href="http://sk2.com/category/linux/">Linux</a></li></ul><div class="textbody"><p><strong>1) Installation:</strong><br />  The first thing to do is to install the packages I mentioned above. If you don’t have Apache installed already, it’ll go ahead and drag that down as well.<br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[root@lucifer ~]# yum install mod_dav_svn subversion</span></p><p><strong>2) Configurations:</strong></p><p><em><strong>a) Apache:</strong></em><br />…</p><p><strong><em>b) Subversion’s Apache configs:</em></strong><br />  The next step is to setup some settings within Apache so Subversion and Apache play nice together. Get yourself to the example configuration file Subversion installed for you.<br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[root@lucifer ~] cd /etc/httpd/conf.d/<br />[root@lucifer ~] vim subversion.conf</span><br /><span style="color: rgb(0, 204, 0); line-height: 1.3em;"># Make sure you uncomment the following if they are commented out<br />LoadModule dav_svn_module     modules/mod_dav_svn.so<br />LoadModule authz_svn_module   modules/mod_authz_svn.so</span><br /><span style="color: rgb(0, 204, 0); line-height: 1.3em;"># Add the following to allow a basic authentication and point Apache to where the actual<br /># repository resides.<br />&lt;Location /repos&gt;<br />        DAV svn<br />        SVNPath /var/www/svn/repos<br />        AuthType Basic<br />        AuthName “Subversion repos”<br />        AuthUserFile /etc/svn-auth-conf<br />        Require valid-user<br />&lt;/Location&gt;</span><br />  The location is what Apache will pass in the URL bar. For instance: http://yourmachine/repos points to the SVNPath that you have specified. My examples are just that, so feel free to put things where you want. Make sure you save the file when you are finished editing.<br />Next we have to actually create the password file that you specified in the previous step. Initially you’ll use the -cm arguments. This creates the file and also encrypts the password with MD5. If you need to add users make sure you simply use the -m flag, and not the -c after the initial creation.<br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[root@lucifer ~] htpasswd -cm /etc/svn-auth-conf yourusername<br />New password:<br />Re-type new password:<br />Adding password for user yourusername<br />[root@lucifer ~] htpasswd -m /etc/svn-auth-conf anotherusername<br />New password:<br />Re-type new password:<br />Adding password for user anotherusername</span></p><p><strong><em>c) Configure your repository</em></strong><br />  The next thing you need to do is to create the actual repository from which you will check in and out your files. This is simple to do with some of the included svn tools.<br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[root@lucifer ~] cd /var/www/ — Or wherever you placed your path above<br />[root@lucifer ~] mkdir svn<br />[root@lucifer ~] cd svn<br />[root@lucifer ~] svnadmin create repos<br />[root@lucifer ~] chown -R apache.apache repos<br />[root@lucifer ~] service httpd restart</span><br />  Go test out whether or not you can access your repository from a web browser: http://yourmachine/repos. You should get a popup box asking for a username and password. If so, type in your credentials and you should be displayed with a Revision 0:/ page. If so, that’s it for setting up a repo. If you want multiple repos, check out the docs from the links provides above. This sets up one repository and shows you how to start using them. Speaking of, let’s move on to just that.</p><p><strong>3) Using Subversion:</strong></p><p><strong><em>a) Layout Your Repo:</em></strong><br />  If all went well above, you’re now ready to start using the repository that you created. Subversions svn tool is the command line client that you will use to talk to the database. To see the use of the tool:<br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[root@lucifer ~] svn –help</span><br />  The most common arguments you will most likely be using are: svn import, svn commit (ci), and svn checkout (co). With these you will initially import files into your repository with import, you’ll check them out to work on them with checkout, and you’ll commit the changes back into the database with commit. It’s pretty simple once you see them in use a few times.<br />Before I continue I’d like to explain about directory structure layouts. Almost all of the documentation talks about creating a certain layout for your directories. They specifically mention about making sure you have a branches, tags, and trunk underneath the root directory structure, where trunk holds all your files. For instance:<br />.<br />|– project1<br />|   |– branches<br />|   |– tags<br />|   `– trunk<br />`– project2<br />    |– branches<br />    |– tags<br />    `– trunk<br />  The book explains why in a bit more detail, and I mainly don’t bother using this type of layout…because I’m not doing coding and maintaining “projects” per se. I’m mainly using it to store configuration files, and text items that aren’t as complex. Set things up for whatever works for you.<br />  As an example, I’m going to just create some dummy directories and throw some files in them. This is from the actual SVN server. Play along.<br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[root@lucifer ~] cd /tmp<br />[root@lucifer ~] mkdir mytestproj<br />[root@lucifer ~] cd mytestproj<br />[root@lucifer ~] mkdir configurations options main<br />[root@lucifer ~] vim configurations/testconf1.cfg — Add whatever you want to these files.<br />[root@lucifer ~] vim options/testopts1.cfg<br />[root@lucifer ~] vim main/mainfile1.cfg</span><br />  Keep in mind that you can layout anything anyway you’d like. Once you have the initial layout of what you want, let’s go ahead and import this up to Subversion.</p><p><strong><em>b) Importing:</em></strong><br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[root@lucifer ~] svn import /tmp/mytestproj/ </span><span style="color: rgb(0, 153, 0); line-height: 1.3em;">file:///var/www/svn/repos/mytestproj</span><span style="color: rgb(0, 153, 0); line-height: 1.3em;"> -m “Initial repository layout for mytestproj”<br />Adding         /tmp/mytestproj/main<br />Adding         /tmp/mytestproj/main/mainfile1.cfg<br />Adding         /tmp/mytestproj/configurations<br />Adding         /tmp/mytestproj/configurations/testconf1.cfg<br />Adding         /tmp/mytestproj/options<br />Adding         /tmp/mytestproj/options/testopts1.cfg</span></p><p><strong><em>c) Checking Out:</em></strong><br />  Now, just to check it out across the web browser: http://yourmachine/repos. You’ll get whatever you have imported showing up to peruse. Once you upload your original layout from the local SVN server, you’re now free to use it remotely on another machine. As long as you are connecting to the Subversion server with the user account(s) that you created earlier. Let’s give it a shot.<br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[me@mylappy ~] mkdir mytestproj<br />[me@mylappy ~] svn co </span><span style="color: rgb(0, 153, 0); line-height: 1.3em;">http://yoursvnserver/repos/mytestproj</span><br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">Authentication realm: &lt;http://yoursvnserver:80&gt; Subversion repos<br />Password for ‘youruser’:<br />A    mytestproj/main<br />A    mytestproj/main/mainfile1.cfg<br />A    mytestproj/configurations<br />A    mytestproj/configurations/testconf1.cfg<br />A    mytestproj/options<br />A    mytestproj/options/testopts1.cfg<br />Checked out revision 1.</span></p><p><strong><em>d) Edit &amp; Commit</em></strong><br />  As you can see, you’ve checked out revision 1 from the Subversion server. Now you can edit some things and commit the changes back to the Subversion server.<br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[me@mylappy ~] cd mytestproj<br />[me@mylappy ~] vim configurations/testconf1.cfg — Add or delete something and save.<br />[me@mylappy ~] svn commit -m “Added a line to testconf1.cfg.”<br />Sending        configurations/testconf1.cfg<br />Transmitting file data .<br />Committed revision 2.</span><br />  The nice thing about this then, is that you can delete all of the directories that you just checked out on your machine. The only reason you checked them out, was to edit them, and then send them back up the line. Web browse to your server to check out the different files.</p><p><strong><em>e) Adding/Deleting Items</em></strong><br />  Now this is all fine and dandy, but how do you add more files to an already existing repo directory? Easy, with the add argument. Go ahead and checkout your latest and greatest, copy a file over to a directory, add, then commit the changes.<br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[me@mylappy ~] svn co </span><span style="color: rgb(0, 153, 0); line-height: 1.3em;">http://yoursvnserver/repos/mytestproj</span><br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">A    mytestproj/main<br />A    mytestproj/main/mainfile1.cfg<br />A    mytestproj/configurations<br />A    mytestproj/configurations/testconf1.cfg<br />A    mytestproj/options<br />A    mytestproj/options/testopts1.cfg<br />Checked out revision 2.</span><br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[me@mylappy ~] cd mytestproj<br />[me@mylappy ~] cp /etc/yum.repos.d/CentOS-Base.repo configurations/<br />[me@mylappy ~] svn add configurations/CentOS-Base.repo<br />A         configurations/CentOS-Base.repo</span><br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[me@mylappy ~] svn commit -m “Added the CentOS Yum repo file.”<br />Adding         configurations/CentOS-Base.repo<br />Transmitting file data .<br />Committed revision 3.</span><br />  To delete items simply use delete instead of add. Commit your changes back up, and you’re good to go. It’s as simple as that. Go back over to your web browser again and you’ll notice the revision number should say 3. You’ll be able to click through the files to pick our your differences as well.</p><p><strong><em>f) Reverting Back:</em></strong><br />  Ok, this is all great but how do I revert back to an older revision…isn’t this the point of Subversion? Yep, it’s easy. If you’re not sure as to what revision you’re at…check out the log command. This is why you put a message in every commit. Short and to the point, but enough information to ring a bell that you perhaps forgot about.<br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[me@mylappy ~] svn log </span><span style="color: rgb(0, 153, 0); line-height: 1.3em;">http://yoursvnserver/repos</span><span style="color: rgb(0, 153, 0); line-height: 1.3em;"> — For the entire repository<br />[me@mylappy ~] svn log </span><span style="color: rgb(0, 153, 0); line-height: 1.3em;">http://yoursvnserver/repos/mytestproj</span><span style="color: rgb(0, 153, 0); line-height: 1.3em;"> — For the specific project</span><br />  You’ll get a nice complete list of revision numbers along with the comments, like I mentioned above. This allows you to pick which revision you want to check back out now.<br /><span style="color: rgb(0, 153, 0); line-height: 1.3em;">[me@mylappy ~] svn co -r 1 </span><span style="color: rgb(0, 153, 0); line-height: 1.3em;">http://yoursvnserver/repos/mytestproj</span><br />This command will drag down revision number 1.</p><p><strong><em>4) Access control lists</em></strong><br />  Usually, you don’t want to give every user access to every repository. You can restrict repository access per user by using ACLs. ACLs can be enabled with the AuthzSVNAccessFile file option, which takes a file name as its parameter. For instance:<br />AuthzSVNAccessFile /etc/svn-acl-conf<br />You can add this to the relevant Location section:<br /><span style="color: rgb(0, 204, 0); line-height: 1.3em;">&lt;Location /repos&gt;<br />        DAV svn<br />        SVNParentPath /var/www/svn/repos<br />        AuthzSVNAccessFile /etc/svn-acl-conf<br />        AuthType Basic<br />        AuthName “Subversion repos”<br />        AuthUserFile /etc/svn-auth-conf<br />        Require valid-user<br />&lt;/Location&gt;</span></p><p>  You can then create /etc/svn-acl-conf. This file consist of sections of the following form:<br /><span style="color: rgb(0, 204, 0); line-height: 1.3em;">[reponame:repopath]<br />user = access</span></p><p>  Where access can be r (read), rw (read-write), or empty (no access at all). The default ACL is to give users no access to a repository. Suppose that there is a repository named framework to which you would like to give john read access, and joe read and write access. You could then add the following section:<br /><span style="color: rgb(0, 204, 0); line-height: 1.3em;">[framework:/]<br />john =  r<br />joe = rw</span></p><p>  It is also possible to create groups in a section named groups, groups are then prefixed with the ‘at’ sign (@) in the access control lists. For instance:<br /><span style="color: rgb(0, 204, 0); line-height: 1.3em;">[groups]<br />staff = joe, george</span><br /><span style="color: rgb(0, 204, 0); line-height: 1.3em;">[framework:/]<br />john =  r<br />@staff = rw</span></p><p>  If you would like to make all repositories readable to all users, you can add a section for the root directory of every repository:<br /><span style="color: rgb(0, 204, 0); line-height: 1.3em;">[/]<br />* = r</span></p></div></div><ul id="flip2" class="flip"><li>Newer:<a href="http://sk2.com/post/161.html">Linux CVS配置</a></li><li>Older:<a href="http://sk2.com/post/159.html">Linux常用命令集</a></li></ul></div>
<div id="footer"><div><a rel="nofollow" class="admin" href="http://sk2.com/login"><small>ADMIN</small></a><address>&copy; 2010 <a href='http://sk2.com/'>blog.sk80.com</a></address></div></div></div></div><script type="text/javascript" src="http://sk2.com/include/js/resize.js"></script><script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">try {var pageTracker = _gat._getTracker("UA-5695529-2");pageTracker._trackPageview();} catch(err) {}</script></body></html>

<script language="javascript" type="text/javascript" src="http://js.users.51.la/3688801.js"></script>
<noscript><a href="http://www.51.la/?3688801" target="_blank"><img alt="&#x6211;&#x8981;&#x5566;&#x514D;&#x8D39;&#x7EDF;&#x8BA1;" src="http://img.users.51.la/3688801.asp" style="border:none" /></a></noscript>